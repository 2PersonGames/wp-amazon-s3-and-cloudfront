!function(a){a(document).ready(function(){function b(){c.html('<li class="loading">'+c.attr("data-working")+"</li>");var b={action:"as3cf-get-buckets",_nonce:as3cf_i18n.get_buckets_nonce};a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:b,error:function(a,b,d){c.html(""),alert(as3cf_i18n.get_buckets_error+d)},success:function(b){c.html(""),"undefined"!=typeof b.success?(b.can_write===!1&&a(".as3cf-can-write-error").show(),a(b.buckets).each(function(a,d){var e=d.Name==b.selected?"selected":"";c.append('<li><a class="'+e+'" href="#" data-bucket="'+d.Name+'"><span class="bucket"><span class="dashicons dashicons-portfolio"></span> '+d.Name+'</span><span class="spinner"></span></span></a></li>')})):alert(as3cf_i18n.get_buckets_error+b.error)}})}a(".as3cf-settings").each(function(){var c=a(this),d=c.find(".as3cf-create-bucket-form");if(d.length){var e=d.find("button"),f=e.text();d.on("submit",function(b){b.preventDefault(),e.text(e.attr("data-working"));var c=d.find('input[name="bucket_name"]').val(),g={action:"as3cf-create-bucket",bucket_name:c,_nonce:as3cf_i18n.create_bucket_nonce};a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:g,error:function(a,b,c){e.text(f),alert(as3cf_i18n.create_bucket_error+c)},success:function(b){e.text(f),"undefined"!=typeof b.success?(a(".as3cf-settings").addClass("as3cf-has-bucket"),a(".as3cf-active-bucket").text(c)):alert(as3cf_i18n.create_bucket_error+b.error)}})})}var g=c.find(".as3cf-change-bucket");g.length&&g.on("click",function(b){b.preventDefault(),a(".updated").hide(),a(".as3cf-settings").removeClass("as3cf-has-bucket")});var h=c.find(".as3cf-refresh-buckets");h.length&&h.on("click",function(a){a.preventDefault(),b()})});var c=a(".as3cf-bucket-list");c.on("click","a",function(b){if(b.preventDefault(),a(this).hasClass("selected"))return void a(".as3cf-settings").addClass("as3cf-has-bucket");var d=this;a(".as3cf-bucket-list a").removeClass("selected"),a(d).addClass("selected"),c.addClass("saving"),a(d).find(".spinner").show();var e=a(d).attr("data-bucket"),f={action:"as3cf-save-bucket",bucket_name:e,_nonce:as3cf_i18n.save_bucket_nonce};a.ajax({url:ajaxurl,type:"POST",dataType:"JSON",data:f,error:function(a,b,d){c.removeClass("saving"),alert(as3cf_i18n.save_bucket_error+d)},success:function(b){a(d).find(".spinner").hide(),c.removeClass("saving"),"undefined"!=typeof b.success?(a(".as3cf-settings").addClass("as3cf-has-bucket"),a(".as3cf-active-bucket").text(e),a(".updated").show()):alert(as3cf_i18n.save_bucket_error+b.error)}})})})}(jQuery);